# Gemini3 Hackathon – App 功能清单（当前实现）

本文件记录目前 TripPilot 前端应用已经实现的功能点，便于展示与继续迭代。

## 1. 目的地搜索与加入行程

- 使用 Google Maps JavaScript API 的 Places 搜索（Places New：`searchByText`）获取候选地点列表。
- 候选列表支持展示增强信息（见第 2 节）。
- 选中候选项时，会再用 Places legacy `getDetails` 回填更稳定字段：
  - `opening_hours`（营业时间）
  - `price_level`（一般消费水平）
- 支持推荐搜索 chips（城市/意图关键词），即使没有搜索结果也会显示推荐入口。

## 2. 地点信息增强（行程可读性）

每个地点会尽量补齐并展示以下信息（字段不可用时做降级）：

- 建议停留多久：根据地点类型/名称启发式给出推荐停留时长，并在多个视图展示。
- 开放/营业时间：
  - 搜索下拉可显示摘要。
  - 选中后通过 legacy `opening_hours.weekday_text` 回填，行程视图中可持续展示。
- 注意事项（Tips）：
  - 为地点生成多条“解释型”提示（考虑用户对当地不熟），支持多条换行展示。
  - 带一定的地区识别与更贴近当地的提示（示例：Sydney/London/Japan）。
- 门票与一般消费：
  - 一般消费来自 `price_level`，映射为“便宜/中等/偏贵”等。
  - 门票采用类型/名称启发式判断（包含 tower/skytree/展望台等强票务关键词时显示“需要（建议提前购票）”）。

## 3. 天气驱动提示与室内备选

- 集成 Open‑Meteo 当前天气查询（带缓存/TTL）。
- 在搜索候选中按天气给出“适合/谨慎/不建议”的提示。
- 当天气不佳时，提供“附近室内备选”列表，并支持一键点选加入行程。

## 4. 路线计算与“更像真实世界”的优化

- 使用 Google Directions API 计算路线（支持 TRANSIT/WALKING/DRIVING）。
- 优化策略：
  - 从“直线距离贪心”升级为“基于 Directions 真实耗时估算的贪心重排”。
  - 带缓存，失败时回退到原有简单策略，保证体验稳定。
- 视图中会提示是否发生了“站点重排”（Stops reordered for efficient path）。

## 5. 营业时间可达性检查（目标：尽量都去）

- 在路线页基于以下因素做“来不来得及”的估算并提示：
  - 出发时间（用户选择）
  - 每段路程耗时（Directions 返回的 duration）
  - 每站建议停留时间
  - 当日营业时间（从 `weekday_text` 解析开关门）
- 输出结果包括：
  - 每站“预计到达/离开”提示
  - 状态标记：OK / 营业时间未知 / 今日不营业 / 已关门 / 来不及
- 当存在问题时，会在路线页显示红色总提示，并给出可操作建议（不删点）：
  - 建议至少提前出发 X 分钟
  - 建议把哪些点的停留减少约 Y 分钟
  - 对“今日不营业”提示：提前出发也无法解决，可改日期或换备选
- WALKING 模式也会触发该提示：若预计到达已跨到次日，会判定为“超出当日行程”，从而显示总提示。

## 6. UI/交互体验修复与增强

- 搜索下拉使用 Portal 渲染到 `document.body`，避免被父容器 `overflow-hidden` 裁剪（例如 Tokyo Tower 候选显示不全的问题）。
- 下拉支持滚动/resize 重新定位、点外部关闭逻辑兼容 Portal。
- 修复点击事件被父级吞掉的问题（室内备选可点击）。

## 7. 已知限制（当前实现的边界）

- 营业时间目前用于“提示与建议”，尚未作为硬约束直接参与路线重排评分（可作为下一步优化）。
- Places New 返回字段存在 best-effort 情况，因此关键字段通过 legacy `getDetails` 做回填增强稳定性。
